<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YUG • Chord PNG Generator</title>

<style>
:root{
  --bg:#0b0b0f;
  --panel:#12121a;
  --violet:rgb(80,0,133);
  --violet-soft:rgba(80,0,133,.25);
  --text:#f2f2f2;
  --line:#e8e6df;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:linear-gradient(180deg,#060608,#0b0b0f);
  color:var(--text);
}

/* HEADER */
header{
  padding:20px;
  border-bottom:1px solid rgba(255,255,255,.05);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.brand{
  font-weight:900;
  font-size:20px;
  letter-spacing:.5px;
}
.brand span{
  color:var(--violet);
}

/* LAYOUT */
main{
  display:grid;
  grid-template-columns:380px 1fr;
  gap:25px;
  padding:25px;
}

.card{
  background:var(--panel);
  border-radius:20px;
  padding:20px;
  border:1px solid rgba(255,255,255,.06);
  box-shadow:0 0 25px var(--violet-soft);
}

h2{
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:.15em;
  margin-bottom:15px;
  color:var(--violet);
}

/* INPUTS */
input, select{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.08);
  background:#0f0f16;
  color:white;
}

button{
  padding:10px 14px;
  border-radius:12px;
  border:none;
  background:var(--violet);
  color:white;
  font-weight:700;
  cursor:pointer;
  margin-top:8px;
  transition:.2s;
}
button:hover{
  background:rgb(110,0,170);
}

/* CANVAS */
.preview{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:15px;
}

canvas{
  max-width:520px;
  width:100%;
  background:black;
  border-radius:15px;
  box-shadow:0 0 40px var(--violet-soft);
}

.small{
  font-size:12px;
  opacity:.6;
}
</style>
</head>

<body>

<header>
  <div class="brand">YUG <span>•</span> Chord PNG Generator</div>
  <div class="small">Shift + clic = change le numéro</div>
</header>

<main>

<!-- ÉDITEUR -->
<div class="card">
  <h2>Éditeur</h2>

  <input id="name" value="Bbm" placeholder="Nom de l'accord">
  <input id="frets" type="number" value="5">
  <input id="strings" type="number" value="6">

  <label>
    <input type="checkbox" id="numbers" checked>
    Afficher numéros
  </label>

  <button onclick="addBarre()">Ajouter barré</button>
  <button onclick="resetAll()">Reset</button>
</div>

<!-- RESULTAT -->
<div class="card preview">
  <h2>Résultat</h2>
  <canvas id="cv" width="1080" height="1350"></canvas>
  <button onclick="download()">Télécharger PNG</button>
</div>

</main>

<script>
const cv = document.getElementById("cv");
const ctx = cv.getContext("2d");

let positions = [];
let barres = [];

function draw(){
  ctx.clearRect(0,0,cv.width,cv.height);
  ctx.fillStyle="black";
  ctx.fillRect(0,0,cv.width,cv.height);

  const name=document.getElementById("name").value;
  const frets=parseInt(document.getElementById("frets").value);
  const strings=parseInt(document.getElementById("strings").value);
  const showNumbers=document.getElementById("numbers").checked;

  const boxW=650;
  const boxH=750;
  const left=(cv.width-boxW)/2;
  const top=350;

  ctx.fillStyle="#e8e6df";
  ctx.font="900 120px system-ui";
  ctx.textAlign="center";
  ctx.fillText(name,cv.width/2,200);

  ctx.lineWidth=4;
  ctx.strokeStyle="#e8e6df";

  ctx.strokeRect(left,top,boxW,boxH);

  for(let s=1;s<strings-1;s++){
    let x=left+(boxW/(strings-1))*s;
    ctx.beginPath();
    ctx.moveTo(x,top);
    ctx.lineTo(x,top+boxH);
    ctx.stroke();
  }

  for(let f=1;f<frets;f++){
    let y=top+(boxH/frets)*f;
    ctx.beginPath();
    ctx.moveTo(left,y);
    ctx.lineTo(left+boxW,y);
    ctx.stroke();
  }

  // DOIGTS
  for(let p of positions){
    let x=left+(boxW/(strings-1))*p.s;
    let y=top+(boxH/frets)*(p.f-0.5);
    ctx.fillStyle="#e8e6df";
    ctx.beginPath();
    ctx.arc(x,y,40,0,Math.PI*2);
    ctx.fill();

    if(showNumbers){
      ctx.fillStyle="black";
      ctx.font="900 60px system-ui";
      ctx.fillText(p.finger,x,y+5);
    }
  }

  // BARRES
  for(let b of barres){
    let y=top+(boxH/frets)*(b.fret-0.5);
    let x1=left+(boxW/(strings-1))*b.from;
    let x2=left+(boxW/(strings-1))*b.to;

    ctx.fillStyle="#e8e6df";
    ctx.beginPath();
    ctx.roundRect(x1-40,y-35,(x2-x1)+80,70,40);
    ctx.fill();

    if(showNumbers){
      ctx.fillStyle="black";
      ctx.font="900 60px system-ui";
      ctx.fillText(b.finger,(x1+x2)/2,y+5);
    }
  }
}

cv.addEventListener("click",e=>{
  const rect=cv.getBoundingClientRect();
  const x=(e.clientX-rect.left)*(cv.width/rect.width);
  const y=(e.clientY-rect.top)*(cv.height/rect.height);

  const boxW=650;
  const boxH=750;
  const left=(cv.width-boxW)/2;
  const top=350;
  const frets=parseInt(document.getElementById("frets").value);
  const strings=parseInt(document.getElementById("strings").value);

  if(x<left||x>left+boxW||y<top||y>top+boxH) return;

  let s=Math.round((x-left)/(boxW/(strings-1)));
  let f=Math.floor((y-top)/(boxH/frets))+1;

  let existing=positions.find(p=>p.s===s&&p.f===f);

  if(existing){
    if(e.shiftKey){
      existing.finger=existing.finger%4+1;
    }else{
      positions=positions.filter(p=>!(p.s===s&&p.f===f));
    }
  }else{
    positions.push({s,f,finger:1});
  }

  draw();
});

function addBarre(){
  let fret=parseInt(prompt("Frette ?"));
  let from=parseInt(prompt("Corde début ? (0=grave)"));
  let to=parseInt(prompt("Corde fin ?"));
  let finger=parseInt(prompt("Doigt (1-4)?"))||1;
  barres.push({fret,from,to,finger});
  draw();
}

function resetAll(){
  positions=[];
  barres=[];
  draw();
}

function download(){
  const link=document.createElement("a");
  link.download="chord.png";
  link.href=cv.toDataURL();
  link.click();
}

draw();
</script>

</body>
</html>
